import pandas as pd
from loguru import logger
import os

def classify_product(name):
    name = str(name)
 
    misc_keywords = [
        # 기존 키워드
        '홍삼', '숙취', '컨디션', '여명', '상쾌환', '종근당', '종건', '정관장', '스틱', '비타C구미오렌지7입', '순수한면', '비비안', '순면',
        '멀티비타', '용기', '세트', '키트', '재료', '소스', '양념', '찌개용', '찌개두부', '녹차1.2L리필', '쌍화',
        '즉석', '조리', '구이', '녹차녹차돌자반',
        '증정', '사은품', '포인트',

        # [새로 추가된 영양제 / 건강보조식품]
        '비타민', '마그네슘', '아르기닌', '에너지샷', '활기력', '앰플', 
        '유산균', '프로바이오틱스', '밀크씨슬', '마그랩', '콜라겐',
        
        # [새로 추가된 숙취해소제]
        '모닝케어', '깨수깡', '레디큐', '헛개파워'
    ]
    if any(word in name for word in misc_keywords):
        return "기타"
    if any(word in name for word in misc_keywords):
        return "기타"

    household = [
        '샴푸', '린스', '컨디셔너', '엘라스틴', '세제', '제습제', '페브리즈', '순한면', '쏘피',
        '다우니', '면도기', '면도6날', '면도날', '중형', '대형', '라이너', '폼', '탈취', '테크', '도루코', 
        '샤프란', '바디피트', '좋은느낌', '디어스킨', '칫솔', '치약', '비누', '순한면','베이킹소다',
        '샤프란', '바디피트', '좋은느낌', '디어스킨', '칫솔', '치약', '비누', '순한면','베이킹소다',
        '티슈', '물티슈', '밴드', '가글', '핸드크림', '하기스', '아우라', 'LG', '피죤', '섬유유연제'
    ]
    if any(word in name for word in household):
        return "생활/위생용품"

    snack = [
        # 1. 과자/스낵류 (위험한 '칩' 대신 구체적 명시)
        '과자', '스낵', '크래커', '쿠키', '비스킷', '감자칩', '나초', '팝콘', '뻥튀기', '강냉이',
        '웨하스', '빼빼로', '칸쵸', '홈런볼', '포카칩', '스윙칩', '프링글스', '꼬깔콘', '새우깡', '맛동산',
        '크라운', '롯데제과', '오리온', '해태', '포테토칩', '꼬북칩', '오징어땅콩', '콘칩', '에이스', '오예스',

        # 2. 젤리/사탕/껌
        '캔디', '사탕', '젤리', '하리보', '마이구미', '왕꿈틀이', '새콤달콤', '마이쮸', '껌', '자일리톨',
        '후라보노', '풍선껌', '마쉬멜로우', '짱셔요', '츄파춥스', '목캔디', '젤리빈', '텐텐', '박하사탕', '이클립스',

        # 3. 초콜릿류 ('초코' 단독 사용 시 초코우유가 끌려오므로 구체화)
        '초콜릿', '초콜렛', '초코바', '초코파이', '가나', '허쉬', '킨더', '페레로로쉐', '킷캣',
        '엠앤엠즈', '트윅스', '스니커즈', '크런키', '자유시간', '핫브레이크', '브라우니', '투익스', '밸런스밀바말차초코'

        # 4. 아이스크림/디저트 ('아이스', '바', '콘' 단독 사용 금지)
        '아이스크림', '하겐다즈', '나뚜루', '파인트', '아이스바', '구슬아이스크림', '설레임', '쭈쭈바',
        '더위사냥', '메로나', '붕어싸만코', '투게더', '베스킨라빈스', '마카롱', '푸딩', '모찌', '다쿠아즈',
        '케이크', '조각케익', '롤케익', '도넛', '카스텔라', '카스테라', '후룻컵', '츄러스', '까눌레',
        '요플레', '플레인', '드링킹', '서울우유)흰우유미니컵',

        # 5. 안주/견과/육가공류 ('아몬드' 단독 시 아몬드브리즈 음료가 끌려오므로 주의)
        '견과', '꿀땅콩', '호두', '믹스넛', '허니버터아몬드', '육포', '오징어', '쥐포', '꾸이맨', '천하장사',
        '맥스봉', '소시지', '핫바', '소세지', '맛밤', '군밤', '건크랜베리', '건망고', '포차24', '안주',
        '비엔나', '프랑크', '스트링치즈', '커피땅콩',

        # 6. 빵/떡/기타 간식 (식사류인 샌드위치, 햄버거 제외)
        '단팥빵', '크림빵', '소금빵', '베이글', '호떡', '만쥬', '슈크림', '에너지바', '프로틴바', '단백질바', 
        '에너지젤', '양갱', '약과', '떡', '츄츄', '차슈'
    ]
    if any(word in name for word in snack):
        return "간식류"


    meal = [
        '밥', '찌개', '육개장', '곰탕', '해장국', '사골', '비비고', '피자', '이모카세',
        '만두', '오뚜기밥', '선지', '된장찌개', '참치', '김치찌개', '컵밥', 
        '도시락', '삼각김밥', '김밥', '샌드위치', '햄버거', '죽', '국밥',
        '면', '라면', '파스타', '안주야', '순대', '족발', '닭발', '볶음밥', '덮밥', '찜닭', '부대찌개' # 식사류 확장
    ]
    if any(word in name for word in meal):
        return "식사류"

    # 음료 (커피, 주스, 탄산, 주류, 유제품 등 모든 액체류)
    beverage = [
        '드링크', '탄산', '음료', '워터',
        '커피', '아메리카노', '라떼', '카푸치노', '마키아또', '에스프레소', '카페', '모카', '콜드브루',
        '콜라', '사이다', '소다', '에이드', '스프라이트', '맥콜', '환타', '웰치스', '코카', '펩시',
        '쥬스', '주스', '차', '보리', '타임', '녹차', '홍차', '옥수수수염', '하늘보리', '헛개', '우엉', '쌍화', # 음료 키워드 확장
        '우유', '두유', '요구르트', '딸기우유', '초코우유', '바나나우유',
        '비타', '맥주', '소주', '막걸리', '와인', '하이볼', '토닉워터', '아몬드브리즈', '두유' # 음료 키워드 확장
    ]
    if any(word in name for word in beverage):
        return "음료"
    
    water_keywords = [
        '삼다수', '아이시스', '백산수', '평창수',
        '동원샘물', '지리산수',
        '에비앙', '볼빅',
        '제주용암수', '제주수', '광동샘물',
        '몽베스트', '크리스탈', '생수'
    ]

    if any(word in name for word in water_keywords):
        return "생수"

    return "기타" # 위에 해당하지 않는 모든 것은 기타로 분류

def run_categorization():
    logger.info("새로운 키워드로 카테고리 분류를 시작합니다.")
    input_path = 'data/cleaned_data.csv'
    output_path = 'data/categorized_data.csv'
    
    if not os.path.exists(input_path):
        logger.error(f"'{input_path}' 파일이 없습니다. 정제 코드를 먼저 실행하세요.")
        return

    try:
        df = pd.read_csv(input_path, encoding='utf-8-sig')
        
        # 카테고리 분류 적용
        df['category'] = df['name'].apply(classify_product)
        
        # 결과 저장
        df.to_csv(output_path, index=False, encoding='utf-8-sig')
        
        logger.success(f"분류 완료: '{output_path}'에 저장되었습니다.")
        print("\n[ 카테고리별 데이터 분포 ]")
        print(df['category'].value_counts())
        
    except Exception as e:
        logger.error(f"분류 작업 중 오류 발생: {e}")

if __name__ == "__main__":
    run_categorization()
